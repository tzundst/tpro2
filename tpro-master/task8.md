## Задание №8

## Тестирование ПО

### Зависимости: [Задание 1][task-1], [VM][task-vm], [Задание 5][task-5], [Задание 7][task-7].

Для разработанной в рамках [задания № 7][task-7] программы составить набор тестов с использованием системы тестирования Catch. 

Файл с тестами должен называться **task7_tests.cpp** и находиться в каталоге `task7`.

**При выполнении задания необходимо использовать систему контроля версий Git**, описание каждого коммита должно начинаться с **task8** плюс описание изменений в текущем коммите. Частота коммитов остаётся на усмотрение разработчика, но содержимое коммитов должно показывать работу над заданием, если это будет просто загрузка кода кусками, то оценка будет снижаться.

**Текущее задание направлено, в первую очередь, на выявление ошибок, а не на их устранение**. Проверяться будет полнота охвата тестами возможных ситаций, а не правильность работы программы. **При наличии времени, допускается устранение ошибок.** Тем не менее должны быть устранены все ошибки, мешающие запуску тестов. Тесты должны выпоняться корректно, подробнее об этом в конце задания.

В `CMakeLists.txt` необходимо добавить отдельную конфигурацию для тестов **"task7_test"**, для сборки в CLion должен быть указан тип конфигурации - Catch

Если виртуальная машина не содержит библиотеку SFML, которая отдельно устанавливалась в соответствующем задании, то текущий файл `CMakeLists.txt` будет выдавать ошибку на отсутствие библиотеки SFML. Необходимо закомментировать все строки, относящиеся к заданию SFML (4 строки) символом `#`.

Наборы тестов должны быть разбиты на 3 группы - каждая группа для одной функции программы, каждая группа может содержать любое количество наборов тестов (TEST_CASE)

```
Пример:

TEST_CASE("Имя_набора_тестов","[Имя_группы_тестов]")

Один набор тестов может принадлежать нескольким группам

TEST_CASE("Имя набора тестов","[группа1][группа2]")
```

Примеры для типов тестов: верные данные (с учетом повторного ввода), неверные данные, отсутствие данных. 

Минимальное количество TEST_CASE - три, по одному для каждого типа тестов - итого минимум 9 наборов тестов (три группы по три набора тестов)

Для работы с файлами – неверными данными может быть содержание в файле строк вместо чисел, отсутствие данных – отсутствие файлов, пустой файл.

Для возможности сравнения файлов по содержимому можно реализовать дополнительно функцию **побайтового** сравнения файлов в бинарном режиме открытия, входными параметрами для которой являются имена файлов, а результатом - порядковый номер байта, с которого файлы отличаются. Если файлы не отличаются, то возвращается 0. Для возможности сравнения должны быть подготовлены **идеальные** файлы, содержащие правильный результат. Функцию для удобства можно разместить в `task7_tests.cpp`, `task7.cpp` или создать новый модуль.

**Для функции сравнения файлов тоже необходимо реализовать тесты, чтобы убедиться, что она правильно работает.**

Каждое условие (требование), описанное в задании на разработку программы необходимо проверить тестированием несколькими типами тестов, например, копирование файла с одной строкой и двумя строками, разное суммирование для разных файлов, шифрование разных файлов. Это по сути является дополнительным видом тестов, который проверяет, что ваши функции не возвращают константные значения и меняют поведение на разных данных. (Это касается только верных данных)

Для хранения используемых файлов с данными предусмотреть подкаталог **data8** в каталоге `task7`, он будет содержать данные после выполнения тестирования. С учетом того, что исходные файлы с данными могут меняться, предусмотреть каталог **data8\source**, где будут храниться файлы с исходными данными до тестирования. Их необходимо копировать в каталог **data8** перед началом тенстирования, предварительно его очистив (вручную или в начале тестов).

Необходимо использовать различные выходные файлы для различных тестов, чтобы результат не перезаписывался. 

Примеры входных данных для тестов (имена входных и выходных файлов, спецификации функций), а также пример TEST_CASE для функции сравнения файлов приведен в файле [task8/requirements.cpp](https://gitwork.ru/sub/tpro/-/blob/master/task8/requirements.cpp) проекта.

Результат тестирования сохранить в виде скриншотов в issue на сдачу задания. Туда должны быть прикреплены скриншоты, показывающие результат запуска тестов в CLion, при этом должно быть открыто окно с текущими тестами (`task7_tests.cpp`). Сохранить результаты тестирования в виде текстового файла (или воспользоваться функцией экспорта результатов тестирования в формате html) в том же каталоге, где расположены входные и выходные данные или приложить к issue.

Примеры написания тестов можно найти в example, скопированном в [задании № 5][task-5], презентациях лекции или документации по Catch

**Сдачу задания можно осуществлять удаленно**. Для сдачи задания создать в **своем** проекте **issue "Сдача task8"** и назначить его преподавателю (Assignee). Без назначения он его не увидит! Все необходимые файлы с данными должны находиться в описанных выше каталогах, результат тестирования экспортировать в текстовом виде и приложить к issue.

**Дополнительное задание** (*): получить у коллеги реализацию его функций (task7.cpp), разметить у себя в каталоге `task7`, назвав файл по его fullname, например `2024-3-00-los.cpp`, создать отдельную конфигурацию для тестирования, назвав, опять же по его fullname_test, напрмер `2024-3-00-los_test`. Провести тестирование, результат тестирования приложить в отдельно осзданном issue "Сдача дополнительной части task8".

Если задание принято, то issue закрывается, если есть замечания, то преподаватель ответит вам в issue и переназначит вам обратно.

**Ключевые слова**: task7_tests, минимум 9 TEST_CASE + TEST_CASE функции сравнения, data8, data8\source, повторный успешный запуск, скриншот результата тестирования, экспорт результата тестирования, дополнительно 2024-3-00-los_test

### Пример-пояснение

```c++
TEST_CASE("f1_empty_correct","[func1][empty tests]") //тестирование работы первой функции c пустым входным файлом
{
	int res=0;
	string in="f1_in_empty.txt";
	string out="f1_out_correct4.txt";
	REQUIRE_NOTHROW(res=FUNC1(in,out)); //вызов первой функции
	CHECK(res==0); //проверка результата работы функции
	CHECK(FILE_DIFF(in,out)==0); //сравнение файлов после работы функции
}
```

В данном примере показано:

1. Принадлежность набора тестов (TEST_CASE) сразу двум группам - группа тестов для первой функции `func1` и группе типом тестов "пустые данные, отсутствие данных" `empty tests`

2. Проверка работоспособности функции вообще, что она не вызывает исключений через `REQUIRE_NOTHROW`, если исключение будет вызвано, то тест прекратится, т.к. `REQUIRE`. Если исключения нет, то тестирование продолжится.

3. Далее полученный результат сравнивается с конкретным значением и проверяется файл через функцию сравнения файлов `FILE_DIFF` (самостоятельно написанную)

### Catch.hpp - не всемогущ

Несмотря на достоинства header-тестов вида "отсутствия необходимости их установки в систему и возможность запуска везде, где есть компилятор", существуют и недостатки, например, невозможность отловить ошибки типа "fail", когда приложение завершает работу некорректно, например, при ошибках работы с памятью. Что связано с тем, что тестируемый модуль не помещается в определенное тестовое окружение, а всего лишь производится вызов в определенном порядке и с определенными параметрами функций тестируемого модуля. Если вы видите что-то вроде `SIGSEGV - Segmentation violation signal`, значит у вас ошибки работы с памятью и тестирование завершилось некорректно и преждевременно. Другой пример - бесконечные циклы, если ваш модуль уходит в бесконечную работу, то и тест будет идти бесконечно, дожидаясь результата работы функции.

Ошибки такого рода необходимо исправлять, добиваясь корректной работы тестов. Ошибки типа "error", нарушающие лишь логику работы программы, при этом программа не "вылетает", допустимы, их можно не исправлять. 

### Если тесты долго компилятся - это устаревшая информация, необходимая для второй версии Catch, в текущей версии данный недостаток устранен

Причина долгой компиляции после незначительного изменения является то, что при каждой компиляции тестов производится еще и компиляция `catch.hpp`, поскольку это header-тесты, а header, как известно, отдельно компилировать нельзя. Функция `main` из `catch.hpp` скрывается за надписью `#define CATCH_CONFIG_MAIN` в файле тестов.

Для ускорения компиляции необходимо разнести `TEST_CASE` и `catch.hpp` по разным файлам.

Например, у вас есть файл `task7_tests.cpp`
```cpp
...
#define CATCH_CONFIG_MAIN
#include "../catch.hpp"

TEST_CASE(....
```
Необходимо разделить `#define` и `TEST_CASE` по разным файлам. Для этого создайте файл, например, `test7-catch.cpp` и перенесите туда строку с `#define` и скопируйте `#include`. 

Должно получится так

файл `test7-catch.cpp`
```cpp
#define CATCH_CONFIG_MAIN
#include "../catch.hpp"
```

файл `task7_tests.cpp`
```cpp
...
#include "../catch.hpp"

TEST_CASE(....
```

Не забудьте включить файл `test7_catch.cpp` в состав конфигурации файла `CMakeLists.txt`

Теперь при каждой очередной компиляции тестов файл `catch.hpp` уже не будет компилироваться, будет компилироваться только `TEST_CASE`. Время компиляции должно существенно уменьшиться!


[task-1]: ./task1.md
[task-5]: ./task5.md
[task-7]: ./task7.md
[task-vm]: ./task_vm_prepare.md