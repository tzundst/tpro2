## Подготовка виртуальной машины для работы с системой управления проектами

### Создание клона подготовленной виртуальной машины
1. Открыть приложение VMware Workstation, выбрать пункт меню "открыть виртуальную машину" (File-Open). Найти и выбрать для открытия виртуальную машину (далее может употребляться как ВМ) `Ubuntu X x64 vY`, где `X` - версия ОС, например, 24.04, а `Y` - версия собранной ВМ, например, 6 (файл с расширением **vmx** в соответствующем каталоге, опознавательный знак - эмблема с 3-мя накладывающимися друг на друга белыми квадратиками). О том, какая версия ВМ сейчас является актуальной, **уточняйте** у своего преподавателя. Расположена ВМ может быть
    * либо в корне диска `V:\Ubuntu X x64 vY` локально на вашем компьютере в компьютерном классе 122
    * либо в сети на файловом сервере 1 отделения, который может быть подключен как сетевой диск `I:`, например, `\\fs.iksi.edu\Iksi\k732\Ubuntu X x64 vY` или `I:\k732\Ubuntu X x64 vY` (из классов 1 отделения может заработать и просто `fs` вместо полного доменного имени `fs.iksi.edu`), или на файловом сервере кафедры, например, `\\192.168.32.252\Courses\Виртуальные машины\Ubuntu X x64 vY`
    * либо на компьютере преподавателя, обычно называется `\\clZ-00\Shared\Ubuntu X x64 vY`, где `Z` - номер компьютерного класса 1 отделения, например, 113 для аудитории 113 или 19 для УНЦ-19

2. Выбрать пункт клонирования виртуальной машины (`VM` - `Manage` - `Clone`). В процессе создания выбирать значения по умолчанию. Обратите внимание, что необходимо создавать связанный клон ВМ (Linked Clone), причём делать это с конкретного снимка состояния ВМ (т.н. Snapshot). Название ВМ можно изменить, но лишь по вашей личной инициативн. Для понимания: связанный клон не может работать без исходной ВМ, связанный клон хранит в себе только изменения относительно исходной ВМ, следовательно, он занимает гораздо меньше места на жестком диске в сравнении с полным клоном ВМ.

3. После создания ВМ **настоятельно** рекомендуется скорректировать параметры экрана ВМ для того, чтобы она сумела бес проблем работать на любом компьютере. Если этого не сделать, можно столкнуться с проблемой, связанной с зависанием ВМ при попытке открыть в ней 2 окошка приложений: например, терминала с левой стороны и браузера с правой стороны. Для выполнения корректировок экрана нужно нажать (<kbd>Правая кнопка мыши</kbd>) по созданной ВМ на панели сверху или слева (в библиотеке, клавиша <kbd>F9</kbd>) и выбрать настройки (Settings). В настройках требуется обратиться к самой нижнему параметру (Display), выбрать его и в правой части убрать галочку с дополнительной обработки 3D-графики и выбрать монитор № 1 с разрешением 1920х1080, более не нужно!

4. Пользователь ОС Ubuntu - **user**, пароль, очевидно, в условиях работы на факультете с таким названием - **user**.

5. Для удобства дальнейшей работы необходимо перевести виртуальную машину в полноэкранный режим (сочетание клавиш <kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>Enter</kbd> или через меню), открыть браузер в ВМ и открыть данную страницу в нем.

### Настройка связи Ubuntu и gitwork.ru
1. Проверка связи с gitwork.ru в ВМ

   Проверьте работоспособность связи командой 
    
   ```bash
   ping gitwork.ru
   ```
   
   Успешный результат выглядит примерно так (IP-адрес может отличаться)
   
   ```bash
   PING gitwork.ru (10.32.100.100) 56(84) bytes of data.
   64 bytes from 10.32.100.100: icmp_req=1 ttl=128 time=0.744 ms
   64 bytes from 10.32.100.100: icmp_req=2 ttl=128 time=1.19 ms
   64 bytes from 10.32.100.100: icmp_req=3 ttl=128 time=1.01 ms
   ```
    
   Для прерывания бесконечного процесса нажмитие <kbd>Ctrl</kbd>+<kbd>C</kbd>
   
   **При успешной связи переходите к созданию SSH-ключа**, в случае отсутствия связи выполните следующие действия.
    
   Периодически в классах возникают проблемы по связи с gitwork.ru. Чтобы их предупредить, необходимо жёстко зафиксировать соответствие IP-адреса и имени gitwork.ru.

   Для этого в консоли (Terminator, для открытия можно воспользоваться сочетанием клавиш <kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>T</kbd>) выполните команду

    ```bash
    sudo nano /etc/hosts
    ```
    
    Введите пароль **user**. 
    
    В редакторе у вас откроется файл, в котором указывается соответствие имен и IP-адресов.
    
    На пустой строке (обычно третья) впишите тот IP-адрес, который вам выдало ранее при команде ping, например, 10.32.100.100, или уточните адрес у преподавателя

    ```bash
    10.32.100.100 gitwork.ru
    ```
    
    Нужный IP-адрес может зависеть от сети, в которой вы работаете (**уточните** у преподавателя). В хостовой ОС можно в консоли выполнить `ping gitwork.ru` и посмотреть IP-адрес в выводе (например, 10.32.100.100).
    Сохраните файл, для этого нажмите <kbd>Ctrl</kbd>+<kbd>S</kbd> (сохранение файла, открытого в редакторе nano) и <kbd>Ctrl</kbd>+<kbd>X</kbd> (закрытие редактора nano) 
    
    Проверьте работоспособность связи командой 
    
    ```bash
    ping gitwork.ru
    ```
    
    Успешный результат выглядит примерно так
    
    ```bash
    PING gitwork.ru (10.32.100.100) 56(84) bytes of data.
    64 bytes from gitwork.ru (10.32.100.100): icmp_req=1 ttl=64 time=0.744 ms
    64 bytes from gitwork.ru (10.32.100.100): icmp_req=2 ttl=64 time=1.19 ms
    64 bytes from gitwork.ru (10.32.100.100): icmp_req=3 ttl=64 time=1.01 ms
    ```
    
    Для прерывания бесконечного процесса нажмитие <kbd>Ctrl</kbd>+<kbd>C</kbd>

2. Создание SSH-ключа (SSH-ключ необходим для беспарольного взаимодействия ВМ и сервера gitwork.ru)
    * В консоли выполнить 

    ```bash
    ssh-keygen
    ```
    * Внимательно прочитать вывод, нажать <kbd>Enter</kbd> на каждый вариант (при нажатии <kbd>Enter</kbd> используется значение по умолчанию, предлагаемое в скобках, это общая практика для Linux-систем).
    * Пароль не вводить (оставить пустым), в противном случае будет включена двухфакторная авторизация, что в дальнейшем потребует подтверждения любого действия с репозиторием путем ввода пароля.
    * По указанному на первом шаге пути будет лежать ключ: если все значения были выбраны по умолчанию, то он будет лежать в домашнем каталоге, в подкаталоге `.ssh`. Важно отметить, что в SSH от версии к версии значение алгоритма шифрования может меняться: где-то это **RSA**, где-то, например, **ED25519** - это влияет лишь на то, как будут называться файлы ключей по умолчанию. Далее рассматривается вариант с алгоритмом RSA.
    * Выполнить
    ```bash
    cat ~/.ssh/id_rsa.pub
    ```
    * Полученный вывод (ваш открытый ключ, от начала и до конца) скопировать в настройки учетной записи в gitwork.ru:
        * слева сверху нужно отыскать панельку, иногда цветную, если тему выбирали не сугубо светлую, на которой представлен favicon самого gitlab - оранжевый псевдо-лисёнок и favicon вашей учётной записи - если ничего не меняли, то скорее всего это круг с цифрой 2 посередине;
        * далее нужно кликнуть на эмблеме своей учётной записи и выбрать одну из предложенных конфигураций, например, `Edit profile`;
        * в меню слева перейти на вкладку `SSH keys`, отыскать в правой части кнопку <kbd>Add new key</kbd> и, очевидн, кликнуть по ней (<kbd>Левая кнопка мыши</kbd>)
        * снова обратиться к открытому терминалу, в котором у вас присутствует вывод публичного ключа, скопировать ключ в буфер тройным нажатием по нему (<kbd>Левая кнопка мыши</kbd>) и поместить в поле `Key` (вы же ещё помните, что выделенный текст в Linux-системах копируется в нужное место с помощью клавиши <kbd>Колесо мыши</kbd>); есть альтернатива этому способу: каким-то образом выделить строку от первого до последнего символов, нажать <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>C</kbd>, а далее сгрузить скопированное в нужное место с помощью <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>V</kbd> или же воспользоваться меню, открывающимся при нажатии клавиши <kbd>Правая кнопка мыши</kbd>: а далее, очевидно, Copy - Paste;
        * проверить, что поле `Title` предзаполнилось строкой, похожей на **user@ubuntu** - это делается при добавлении очередного ключа в gitlab по умолчанию; это значение рекомендуется локализовать, указав в `Title` название по шаблону `ubuntu_аудитория_компьютер`, например, ubuntu_113_01 - при наличии такого ключа можно знать, что из 113 аудитории с компьютера 01 доступ есть);
        * нажать на кнопку <kbd>Add key</kbd> и убедиться в корректном добавлении ключа в список (добавится запись в открывшейся таблице);
    * После этого gitwork.ru знает вас как владельца соответствующих SSH-сертификатов. Следующей командой убедитесь, что gitwork.ru может узнать ваш `fullname` (`firstname`)
    
    ```bash
    ssh -T git@gitwork.ru
    ```
    * На вопрос ответьте **yes** (при первом использовании ключа спрашивается, доверяете ли вы удаленному компьютеру, соответствующая запись добавляется в конфигурационный SSH-файл с названием `known_hosts`, но это детали..).  
    Если в консоли получен верный username (ваш в данном случае), то всё с настройкой SSH сделано правильно.
    
### Создание копии репозитория
1. Открыть терминал на рабочем столе. Результат выполнения команды **pwd** (узнать текущий каталог) должен писать `/home/user`. 
2. Измените текущий каталог на `~/Desktop` (Рабочий стол), для этого выполните команду:
    ```bash
    cd Desktop
    ```
    
    Лирическое отступление про смену каталогов (не требующее выполнения):
     ```bash
    # Узнать текущий каталог можно командой
    pwd
    
    # Перейти в каталог /home/user/Desktop/tpro, это путь к каталогу вашего проекта по умолчанию для данного задания
    cd /home/user/Desktop/tpro
    
    # Перейти в подкаталог test текущего каталога
    cd test
    
    # Получить содержимое каталога со скрытыми файлами
    ls -la
     ```
     
    Указанные далее команды позволяют скопировать ваш проект (также употребляется термин репозиторий, который обозначает то же самое, что и проект) с сервера gitwork.ru. Необходимо использовать **свои данные**, а не указанные ниже, это пример. 

    ```bash
    # настройки локального git - ваше имя пользователя и почта. Используйте логин (username) из gitwork.ru вместо "ваш_логин". 
    git config --global user.name "ваш_логин"
    git config --global user.email "ваш_логин@gitwork.ru"
    ```
    
    Если у вас есть предпочитаемый редактор в Linux, то можете установить редактор по умолчанию, который будет вызываться каждый раз, когда от вас потребуется информация по commit или редактирование файлов. По умолчанию это редактор `vim` (но есть и человеческие редакторы, например, `nano` или `mc`, не правда ли?).
    
    Проверить установку текущего редактора (а также другие настройки) можно, выполнив команду
    
    ```bash
    # полный варианты команды
    git config --list
    # или вариант с сокращённым флажком
    git config -l
    ```
    Параметр, отвечающий за формат отображения имен файлов, - это **core.quotepath**. По умолчанию он включен (true) - при этом русские имена файлов отображаются в виде кодов символов таблицы Unicode, что не совсем удобно, если хочется получить русские имена файлов и удобно с ними работать, необходимо выполнить команду
    
    ```bash
    git config --global core.quotepath false
    ```
    
    Параметр, отвечающий за редактор по умолчанию, - это **core.editor**
    
    Если вы хотите установить любой другой редактор, например `nano`, то необходимо выполнить
    
    ```bash
    git config --global core.editor nano
    ```
    Либо оставить все как есть и идти путём сильных за руку с `vim`.
    
    Лирическое отсутпление про `vim`
    ```text
    Редактор имеет несколько режимов работы
    От режима работы зависит, как меняется редактируемый файл

    В обычном режиме, который включен изначально, вы не можете изменять файл так, как вы привыкли в любом другом редакторе
    При нажатии определенного символа данный символ не будет введен, а произойдет то или иное действие

    Наиболее важный режим - это редактирование, он включается, если в обычном режиме нажать клавишу i (от слова INSERT)
    Находясь в этом режиме, можно редактировать файл в привычном режиме. Сигнализация о том, что вы находитесь в режиме редактирования, является надпись внизу экрана --INSERT--
    Выйти из режима можно клавишей ESC
    
    Выйти с сохранением - в обычном режиме нажать Shift-Z-Z
    Выйти без сохранения - в обычном режиме ввести :q! <ENTER>
    
    Этих действий будет вам достаточно для ввода информации о commitе - Последовательность действий: i - Редактирование - ESC - Shift-Z-Z
    
    Понимание основных команд по работе с редактором VIM можно получить выполнив команду,
    
    vimtutor ru
    ```
    Теперь можно производить само копирование репозитория командой
    
    ```bash
    git clone ssh://git@gitwork.ru/ваш_логин/tpro.git
    ```

    Либо же можно опустить протокол подключения к gitwork.ru, точнее использовать встроенный протокол СКВ git, выполнив комнду
    ```bash
    git clone git@gitwork.ru:ваш_логин/tpro.git
    ```

3. Возможно, будет выдан запрос, доверяете ли вы неизвестному хосту (`The authenticity of host '[gitwork.ru]' can't be established.`) - противодействие атаке "третий посередине" или **Man in The Middle** (т.н. **MITM**). Введите **yes**.
4. На рабочем столе появился каталог `tpro` с содержимым вашего репозитория. Выполните
    
    ```bash
    cd tpro
    cat README.md
    ```
    **Если возникла ошибка при работе с файлом README.md**, возможно, файл называется-по другому: readme.md, Readme.md, README.md, - это зависит от того, как у вас создавался проект на первом занятии, проверьте через веб-интерфейс и в дальнейшем вводите такое имя файла, какое у вас в репозитории, либо же промежуточно после перехода в каталог воспользуйтесь командой `ls -l`

5. Убедитесь, что на экране ваш репозиторий.
Для того, чтобы перемещаться в репозитории выше по уровню (вернуться в `Desktop` из `tpro`), используйте команду
    ```bash
    cd ..
    ```
    
### На этом подготовка виртуальной машины закончена - вы получили работающую виртуальную машину, связанную с системой управления проектов и склонировали себе репозиторий с сервера. Можно возвращаться к заданию.

### Если новое занятие начинается в новом классе, на новом компьютере, или из под учетной записи другого пользователя необходимо заново настроить ВМ:
* проверить настройки процессоров и памяти ВМ;
* проверить и при необходимости настроить доступность gitwork.ru (/etc/hosts);
* сгенерировать SSH-ключ и прописать его в настройках пользователя https://gitwork.ru;
* сконфигурировать git окружение с помощью **git config**;
* забрать проект с сервера командой **git clone** или (если проект уже есть) обновить его командой **git pull**;
* по окончании занятия загрузить проект на сервер командой **git push** (можно загружать и в процессе занятия, но по окончании обязательно - следующее занятие может проходить в другом классе).
 
Подробный синтаксис команд см. выше.

## Далее приведен ряд команд Git. Можно с ними ознакомится, выполнение для первоначальной настройки виртуальной машины не требуется
    
## Работа в git
1. **Проверка статуса проекта и синхронизация репозиториев**
    * В консоли выполните

    ```bash
    # вы должны быть в каталоге /home/user/Desktop/tpro
    git status
    ```    
    * Красным отмечены неотслеживаемые файлы - git за ними не следит. Файлы, указанные в `.gitignore` (найдите файл в каталогах проекта), не отображаются - их git игнорирует.
    * Через редактор измените файл README.md, добавьте в конец строку "новые изменения" 
    
    ```bash
    nano README.md
    ```
    
    * В консоли наберите (указанный код зафиксирует и загрузит только файл README.md)
    
    ```bash
    git add README.md
    git commit -m 'изменен README.md через UBUNTU'
    git push origin master
    ```
    * Если забудете указать параметр `-m` в команде `commit`, то будет вызван редактор по умолчанию для описания коммита: необходимо вписать туда текст и сохранить.
    * Проверьте через веб-интерфейс, что правки теперь есть и на сервере;
   
2. **Если добавили лишнее**
    
    Если вы случайно или ошибочно добавили (проиндексировали) файлы, которые не должны быть в проекте, например, если у вас неправильно был настроен файл `.gitignore`, то отменить результат команды `add` можно следующей командой

    ```bash
    git rm --cached FILENAME
    ```

    Представленная команда `rm` с флагом `--cached` убирает файл из области индексации, файл снова становится 'untracked'. Использование `rm` без ключа `--cached` полностью удалит файл с диска (однако до выполнения команды `commit` его всё равно можно будет восстановить, не волнуйтесь - git подскажет как!). Ключ `-r` (recursive) выполняет то же рекурсивно для подкаталогов и файлов в них, ключ `-f` (force) - в случае защиты файлов
    
3. **Перепроверить!**  
    **Самая распространенная ошибка** - это наличие в проекте временных файлов среды разработки - каталогов **.idea** и **cmake-build-debug**. Устранить это можно так, как описано выше, при наличии таких каталогов в проекте **оценка будет снижаться**.

4. **Выполнение заданий**

Вы должны четко понимать, где находится актуальная (последняя) копия вашего проекта:
* на сервере gitwork.ru
* на ВМ в компьютерном классе
* на носителе (если взяли код через администраторов, чтобы доделать дома)

Идеально состояние, когда в промежутках между занятиями актуальная копия вашего проекта находится на сервере. Это позволяет вам начать следующее занятие с той же точки в любой аудитории на любом компьютере либо подойти к преподавателю и показать исходный код.

Для достижения такого состояния необходимо каждое занятие начинать с команды **git pull** (забрать проект) и заканчивать командой **git push** (отдать проект). Если вы работаете на новой ВМ, то вместо команды `pull` будет `clone`.

Необходимо добиваться успешного выполнения указанных команд и адекватно реагировать на все выводимые ошибки.

### P.S.

Подробнее информацию по командам и состояниям файлов можно найти в файлах [git_short.md](https://gitwork.ru/sub/tpro/-/blob/master/git_short.md), [git_full.md](https://gitwork.ru/sub/tpro/-/blob/master/git_full.md), рисунках [Состояния Git (начальное представление)](https://gitwork.ru/sub/tpro/-/blob/master/info/%D0%A1%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_GIT_-_simpliest.jpg), [Состояния Git кратко](https://gitwork.ru/sub/tpro/-/blob/master/info/%D0%A1%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_GIT_-_simple.jpg), [Состояния Git подробно](https://gitwork.ru/sub/tpro/-/blob/master/info/%D0%A1%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F%20GIT_-_full.jpg). Wiki [Состояния Git](https://gitwork.ru/sub/tpro/-/blob/master/info/%D0%A1%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_GIT.md). Ну или более полная информация может быть найдена в книгах [PROGIT](https://gitwork.ru/sub/tpro/-/blob/master/info/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0/Git/progit_v2.1.84.pdf) и [Чакон.С Git для профессионального программиста](https://gitwork.ru/sub/tpro/-/blob/master/info/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0/Git/Git%20%D0%B4%D0%BB%D1%8F%20%D0%BF%D1%80%D0%BE%D1%84%D0%B5%D1%81%D1%81%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B3%D0%BE%20%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%81%D1%82%D0%B0.pdf). Все это есть в данном проекте

